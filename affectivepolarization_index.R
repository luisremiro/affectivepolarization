#Affective polarization - DO file Comellas
#May, 12 of 2022

rm(list = ls())
library(tidyverse)

#Merge the IMD dataframe with the last round of the CSES survey

df <- read.csv("data/cses_imd.csv")

df$wave <- NA
df$wave[df$IMD1008_MOD_1 == 1] <- 1
df$wave[df$IMD1008_MOD_2 == 1] <- 2
df$wave[df$IMD1008_MOD_3 == 1] <- 3
df$wave[df$IMD1008_MOD_4 == 1] <- 4
df$wave <- as.factor(df$wave)

pol.af <- df %>% select(IMD1005, wave, IMD1004, IMD1006_NAM,IMD1008_YEAR, IMD1009, IMD1015, IMD1013_M, IMD1013_D, IMD1013_Y,IMD2001_1,IMD2002, IMD2003, IMD2005, IMD2006, IMD3005_1, IMD3005_2, IMD3005_3, IMD3005_4, IMD3006, IMD3008_A,IMD3008_B,IMD3008_C, IMD3008_D, IMD3008_E, IMD3008_F, IMD3008_G, IMD3008_H, IMD3008_I,IMD3009_A,IMD3009_B,IMD3009_C, IMD3009_D, IMD3009_E, IMD3009_F, IMD3009_G, IMD3009_H, IMD3009_I,IMD3010, IMD3014,  IMD5001_A, IMD5001_B, IMD5001_C, IMD5001_D, IMD5001_E, IMD5001_F, IMD5001_G,IMD5001_H, IMD5001_I, IMD5005_A, IMD5005_B, IMD5005_C, IMD5005_D, IMD5005_E, IMD5005_F, IMD5005_G,IMD5005_H, IMD5005_I, starts_with("IMD5000"))

cses5 <- read_csv("data/cses5.csv") %>% select(E1005,E1004, E1006_NAM,E1008, E1015, E1022, E1032,E1033,E1034,E2001_Y, E2002, E2003, E2013, E2010, E3024_1, E3024_2, E3024_3, E3024_4, E3020, E3017_A,E3017_B,E3017_C, E3017_D, E3017_E, E3017_F, E3017_G, E3017_H, E3017_I,E3018_A,E3018_B,E3018_C, E3018_D, E3018_E, E3018_F, E3018_G, E3018_H, E3018_I, E3023, E3009, E5001_A, E5001_B, E5001_C, E5001_D, E5001_E, E5001_F, E5001_G,E5001_H, E5001_I, E5005_A, E5005_B, E5005_C, E5005_D, E5005_E, E5005_F, E5005_G,E5005_H, E5005_I, starts_with("E5000"))

cses5$wave <- 5
cses5$wave <- as.factor(cses5$wave)

cses5$E2001_Y <- ifelse(cses5$E2001_Y > 9000, NA,cses5$E2001_Y)
cses5$edad <- cses5$E1034 - cses5$E2001_Y
cses5$E2001_Y <- NULL
cses5 <- cses5 %>% rename(IMD1005=E1005, IMD1004 =E1004, IMD1006_NAM=E1006_NAM, IMD1008_YEAR =E1008, IMD1009=E1015, IMD1015=E1022, IMD1013_M=E1032, IMD1013_D=E1033, IMD1013_Y=E1034, IMD2001_1 =edad, IMD2002 =E2002,  IMD2003 =E2003, IMD2005 =E2013, IMD2006=E2010, IMD3005_1 =E3024_1, IMD3005_2=E3024_2, IMD3005_3=E3024_3, IMD3005_4=E3024_4, IMD3006=E3020, IMD3008_A=E3017_A, IMD3008_B=E3017_B, IMD3008_C=E3017_C, IMD3008_D=E3017_D, IMD3008_E=E3017_E, IMD3008_F=E3017_F, IMD3008_G=E3017_G, IMD3008_H=E3017_H, IMD3008_I=E3017_I, IMD3009_A=E3018_A, IMD3009_B=E3018_B, IMD3009_C=E3018_C, IMD3009_D=E3018_D, IMD3009_E=E3018_E, IMD3009_F=E3018_F, IMD3009_G=E3018_G, IMD3009_H=E3018_H, IMD3009_I=E3018_I, IMD3010=E3023, IMD3014=E3009, IMD5001_A=E5001_A, IMD5001_B=E5001_B, IMD5001_C=E5001_C, IMD5001_D=E5001_D, IMD5001_E=E5001_E, IMD5001_F=E5001_F, IMD5001_G=E5001_G, IMD5001_H=E5001_H, IMD5001_I =E5001_I, IMD5005_A=E5005_A, IMD5005_B=E5005_B, IMD5005_C=E5005_C, IMD5005_D=E5005_D, IMD5005_E=E5005_E, IMD5005_F=E5005_F, IMD5005_G=E5005_G, IMD5005_H=E5005_H, IMD5005_I=E5005_I, IMD5000_A=E5000_A, IMD5000_B=E5000_B, IMD5000_C=E5000_C, IMD5000_D=E5000_D, IMD5000_E=E5000_E, IMD5000_F=E5000_F, IMD5000_G=E5000_G, IMD5000_H=E5000_H, IMD5000_I = E5000_I)

cses5_1 <- cses5 %>% select(!starts_with("E5000_L"))

df_ap <- rbind(pol.af, cses5_1)

df_ap <- df_ap %>% rename(CountryYear = IMD1004)

table(df_ap$CountryYear)

#Recode missing values to missing

## Parties

df_ap <- df_ap %>% mutate(
  LikeP_A = ifelse(IMD3008_A >= 95, NA,IMD3008_A),
  LikeP_B = ifelse(IMD3008_B >= 95, NA,IMD3008_B),
  LikeP_C = ifelse(IMD3008_C >= 95, NA,IMD3008_C),
  LikeP_D = ifelse(IMD3008_D >= 95, NA,IMD3008_D),
  LikeP_E = ifelse(IMD3008_E >= 95, NA,IMD3008_E),
  LikeP_F = ifelse(IMD3008_F >= 95, NA,IMD3008_F),
  LikeP_G = ifelse(IMD3008_G >= 95, NA,IMD3008_G),
  LikeP_H = ifelse(IMD3008_H >= 95, NA,IMD3008_H),
  LikeP_I = ifelse(IMD3008_I >= 95, NA,IMD3008_I)
)

## Leaders

df_ap <- df_ap %>% mutate(
  LikeL_A = ifelse(IMD3009_A >= 95, NA,IMD3009_A),
  LikeL_B = ifelse(IMD3009_B >= 95, NA,IMD3009_B),
  LikeL_C = ifelse(IMD3009_C >= 95, NA,IMD3009_C),
  LikeL_D = ifelse(IMD3009_D >= 95, NA,IMD3009_D),
  LikeL_E = ifelse(IMD3009_E >= 95, NA,IMD3009_E),
  LikeL_F = ifelse(IMD3009_F >= 95, NA,IMD3009_F),
  LikeL_G = ifelse(IMD3009_G >= 95, NA,IMD3009_G),
  LikeL_H = ifelse(IMD3009_H >= 95, NA,IMD3009_H),
  LikeL_I = ifelse(IMD3009_I >= 95, NA,IMD3009_I)
)


# Weighted spread of like-dislike scores towards parties/leaders

